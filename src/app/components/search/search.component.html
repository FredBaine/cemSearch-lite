<div class="search-container">
  <div class="header">
    <h2>Cemetery Search</h2>
  </div>

  <!-- Search Form -->
  <div class="search-section">
    
    <div class="search-form">
      <div class="search-row single-row">
        <div class="form-group name-search">
          <mat-form-field appearance="outline" class="search-input">
            <mat-label>Name</mat-label>
            <input 
              matInput
              [ngModel]="searchName()"
              (ngModelChange)="searchName.set($event)"
              (keypress)="onSearchNameKeyPress($event)"
              (input)="onSearchNameInput()"
              placeholder="Search by occupant name...">
            @if (searchName()) {
              <button 
                type="button" 
                matSuffix
                mat-icon-button
                (click)="clearSearchName()"
                title="Clear name">
                <mat-icon>clear</mat-icon>
              </button>
            }
          </mat-form-field>
        </div>

        <div class="form-group search-actions-inline">
          <div class="search-buttons">
            <button 
              mat-raised-button 
              color="accent" 
              (click)="search()" 
              [disabled]="isLoading()"
              class="search-btn">
              @if (isLoading()) {
                <mat-spinner diameter="20"></mat-spinner>
              }
              {{ isLoading() ? 'Searching...' : 'Search' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Results Section -->
  @if (records().length > 0 || isLoading()) {
    <div class="results-section">
      <div class="results-header">
        <h3>Search Results</h3>
        @if (currentSearchType() && !isLoading()) {
          <div class="search-info">
            <small class="search-type">Search type: {{ getSearchTypeDisplay() }}</small>
          </div>
        }
        @if (!isLoading()) {
          <div class="results-count">
            Found {{ records().length }} record{{ records().length !== 1 ? 's' : '' }}
          </div>
        }
      </div>

      @if (isLoading()) {
        <div class="loading">
          <mat-spinner diameter="40"></mat-spinner>
          <p>Searching records...</p>
        </div>
      }

      @if (!isLoading() && records().length > 0) {
        <!-- Mobile Cards View -->
        <div class="mobile-results">
          @for (record of records(); track record.id) {
            <mat-card class="record-card" (click)="onRowClick(record)">
              <mat-card-content>
                <div class="record-header">
                  <h3 class="occupant-name">{{ record.occupant }}</h3>
                  @if (record.burialDate) {
                    <span class="burial-date">{{ record.burialDate }}</span>
                  }
                </div>
                
                @if (record.section || record.lot || record.site || record.space) {
                  <div class="record-details">
                    <div class="location-info">
                      <mat-icon>place</mat-icon>
                      <span>
                        @if (record.section) { Section {{ record.section }} }
                        @if (record.lot) { Lot {{ record.lot }} }
                        @if (record.site) { Site {{ record.site }} }
                        @if (record.space) { Space {{ record.space }} }
                      </span>
                    </div>
                    <div class="card-action">
                      <mat-icon>arrow_forward_ios</mat-icon>
                    </div>
                  </div>
                }
              </mat-card-content>
            </mat-card>
          }
        </div>

        <!-- Desktop Table View -->
        <div class="table-container desktop-results">
          <table class="records-table">
            <thead>
              <tr>
                <th>Occupant Name</th>
                <th>Section</th>
                <th>Lot</th>
                <th>Burial Date</th>
              </tr>
            </thead>
        <tbody>
          @for (record of records(); track record.id) {
            <tr class="record-row clickable-row" (click)="onRowClick(record)">
              <td>{{ record.occupant }}</td>
              <td>{{ record.section }}</td>
              <td>{{ record.lot }}</td>
              <td>{{ record.burialDate }}</td>
            </tr>
          }
        </tbody>
      </table>
        </div>
      }

  @if (!isLoading() && records().length === 0) {
    <div class="no-results">
      <p>No records found matching your search criteria.</p>
    </div>
  }
</div>
}

  <!-- Empty State -->
  @if (records().length === 0 && !isLoading()) {
    <div class="empty-state">
      <h3>Cemetery Records Search</h3>
      <p>Search for cemetery records by occupant name (partial matches supported).</p>
      <p>Enter an occupant name above and click Search or press Enter. Click any result row to view the location on the map.</p>
    </div>
  }
</div>
